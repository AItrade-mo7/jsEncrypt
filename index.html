<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>demo App</title>
    <link href="//cdn.bootcdn.net/ajax/libs/normalize/8.0.1/normalize.css" rel="stylesheet" />
    <script src="//cdn.jsdelivr.net/npm/cash-dom/dist/cash.min.js"></script>
    <script src="//unpkg.zhimg.com/axios/dist/axios.min.js"></script>
    <script type="module" src="/src/main.ts"></script>

    <script>
      window.http = (function () {
        const axios = window.axios;

        const service = axios.create();

        const $axios_set_default = () => {
          service.defaults.baseURL = 'http://msg.mo7.cc'; // 默认请求的 baseUrl

          //请求拦截
          service.interceptors.request.use(
            (config) => {
              // console.info('请求开始');
              return config;
            },
            (error) => {
              console.error(error);
              return Promise.reject(error);
            },
          );

          //响应拦截
          service.interceptors.response.use(
            (response) => {
              // console.info('请求结束');
              return response;
            },
            (error) => {
              return Promise.reject(error);
            },
          );
        };

        $axios_set_default();

        const ajax = (param) => {
          const config = {
            headers: {
              'Auth-Encrypt': mo7Encrypt(param.url + window.navigator.userAgent),
            },
            ...param,
          };

          if (param?.data?.CoinServeID) {
            config.headers['Coin-Serve-ID'] = param.data.CoinServeID;
          }

          // 请求参数转换
          if (config.method === 'get' || !config.method) {
            config.params = config.data;
            delete config.data;
          }
          return service(config);
        };

        return {
          ajax,
        };
      })();
    </script>
  </head>
  <body>
    <button class="runShellBtn pure-button pure-button-primary">执行</button>
  </body>
</html>

<script>
  $('.runShellBtn').on('click', () => {
    http
      .ajax({
        url: '/api/async/InsertTaskQueue',
        data: {
          Password: 123123,
          ShellID: 1,
        },
        method: 'post',
      })
      .then((res) => {
        const data = res.data;
        console.log(data);
      });
  });
</script>
